# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар:

```
export interface IItem {
    _id: string;
    index: number;
    title: string;
    category: string;
    image: string;
    description: string;
    price: number;
}
```

Массив товаров с указанием открытого в модалке товара:

```
export interface IItemData {
    items: IItem[];
    previewId: string | null;
    getItems(): IItem[];
    getItem(itemId: string): IItem;
}
```

Товар, открытый в модалке:

```
//export type TItemInfo = Pick<IItem, '_id' | 'title' | 'category' | 'image' | 'price'>;
```

Корзина:

```
export interface IBasket {
    itemsArr: IItem[];
    total: number;
    //getItems(): IItem[];
    //addItem(item: IItem): void;
    //delItem(item: IItem): void;
}
```

Данные заказа 

```
export type TOrderData = {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

Заказ:

```
export interface IOrder extends TOrderData {
    //basket: IBasket;
    //payment: string;
    //address: string;
    //email: string;
    //phone: string;
    //price: number;
    step: number;
    isConfirmed: boolean;
    checkOrderValidation(payment: string, address: string): boolean;
    checkContactsValidation(email: string, phone: string): boolean;
    addOrderDataToOrder(payment: string, address: string): void;
    addContactsToOrder(email: string, phone: string): void;
}
```

Заказ

```
export interface IPurchase extends IBasket, TOrderData {
}
```

Тип данных, возвращаемый сервером при отправке заказа по API

```
export type TPurchaseSaveResponse = {
    mode: string,
	raw: IPurchase
}
```

Данные о товарах, возвращаемые сервером

```
export type IItemApi = {
    total: number;
    items: IItem[]
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

## Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Интерфейс Item 
Интерфейс описывает поля товара.\
В полях класса хранятся следующие данные:
- `id: string` - id товара
- `title: string` - название товара
- `category: string` - категория товара
- `image: string` - изображение товара
- `description: string` - описание товара
- `price: number` - стоимость товара

#### Класс ItemData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `items: IItem[]` - массив объектов товаров
- `previewId: string | null` - id товара, выбранного для просмотра в модальном окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `getItems(): IItem[]` - возвращает массив товаров
- `getItem(itemId: string): IItem` - возвращает товар по его id
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Basket 
Класс хранит список товаров, добавленных в корзину.\
В полях класса хранятся следующие данные:
- `items: IItem[]` - массив товаров, добавленных в корзину
- `total: number` - суммарная стоимость товаров в корзине

//Так же класс предоставляет набор методов для взаимодействия с этими данными:
//- `getItems(): IItem[]` - возвращает массив товаров
//- `addItem(item: IItem): void` - добавляет товар в корзину
//- `delItem(item: IItem): void` - удаляет товар из корзины

#### Класс Order
Класс отвечает за сохранение данных заказа и отправку заказа на сервер.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
//- `basket: IBasket` - корзина - список товаров. которые покупатель хочет заказать
- `payment: string` - способ оплаты
- `address: string` - адрес доставки
- `email: string` - адрес электронной почты
- `phone: string` - контактный телефон
//- `cost: number` - стоимость заказа
- `step: string` - название шага, на котором остановился покупатель при оформлении заказа. При закрытии окна оформления и дальнейшем открытии корзины покажем тот шаг, на котором остановился покупатель. Если статус заказа = "Оформлен", шаг становится равным null
- `isConfirmed: boolean` - статус заказа: оформлен или еще нет. Если статус заказа = "Оформлен", корзину очищаем
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
//- `checkValidation(order: IOrder): boolean` - проверяет объект с данными заказа на валидность
- `checkOrderValidation(payment: string, address: string): boolean` - проверяет данные способа оплаты и адрес на валидность
- `checkContactsValidation(email: string, phone: string): boolean` - проверяет контакты покупателя на валидность
- `addOrderDataToOrder(payment: string, address: string): void` - добавляет в заказ способ оплаты и адрес доставки
- `addContactsToOrder(email: string, phone: string): void` - добавляет в заказ контакты покупателя: email и телефон
//- `saveOrder(order: IOrder): boolean` - отправка данных о заказе на сервер, возвращает признак успешности оформления заказа
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Тип IPurchase 
Предоставляет описание типа данных по заказу в формате, нужном для отправки заказа по API.
- `payment: string` - способ оплаты
- `address: string` - адрес доставки
- `email: string` - адрес электронной почты
- `phone: string` - контактный телефон
- `items: IItem[]` - массив товаров, добавленных в корзину
- `total: number` - суммарная стоимость товаров в корзине

#### Класс Purchase
Собирает данные по заказу в формате, нужном для отправки заказа по API.\
Наследуется от класса Order.\


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные категории, названия, изображения, описания, стоимости. Класс используется для отображения карточек товаров на главной странице сайта, в модальном окне, строки товара в корзине. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
//?- `isInBasket(): boolean` - метод возвращает признак наличия товара в корзине
- `render(template: HTMLElement): HTMLElement` - метод возвращает полностью заполненную карточку товара с установленными слушателями
- геттер id возвращает уникальный id карточки, который равен id товара

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. 
Модальное окно - пустой контейнер для отрисовки любого содержимого.
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - брокер событий
- `content: HTMLElement` - html-элемент для отрисовки содержимого окна

Методы:
- `renderContent` - добавляет переданный html-элемент как дочерний в контейнер
- `open` - показывает модальное окно
- `close` - закрывает модальное окно
- `handleEscUp` - функция закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. 

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `item:selected` - выбор товара для отображения в модальном окне
//- `basket:changed` - изменение состава корзины
- `order:changed` - изменение данных заказа на любом шаге
- `order:changedstatus` - изменение статуса заказа на 4м шаге
- `basket:clear` - необходима очистка данных корзины  (событие произойдет после оформления заказа)
- `order:clear` - необходима очистка данных заказа (событие произойдет после оформления заказа)


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:open` - открытие модального окна с карточкой товара
/*- `basket:add` - добавление товара в коризну
- `basket:del` - удаление товара из корзины*/
- `basket:change` - изменение состава корзины
- `basket:open` - открытие корзины
- `order:start` - нажатие кнопки "Оформить" в корзине
- `purchase-basket:validation` - событие, сообщающее о необходимости валидации 1го шага оформления заказа - проверки на отсутствие в корзине бесценного товара
- `purchase-order:validation` - событие, сообщающее о необходимости валидации 2го шага оформления заказа - ввод способа оплаты и адрес
- `purchase-contacts:validation` - событие, сообщающее о необходимости валидации 3го шага оформления заказа - ввод email и телефона
- `order:changed` - указание валидных данных на одном из шагов оформления заказа
- `order:confirm` - подтверждение (окончание) оформления заказа

